package com.wipro.fooddeliveryapp.menu.servicess;

import java.util.List;

import org.springframework.stereotype.Service;

import com.wipro.fooddeliveryapp.menu.entity.Menu;
import com.wipro.fooddeliveryapp.menu.entity.RestaurantDTO;
import com.wipro.fooddeliveryapp.menu.feign.RestaurantClient;
import com.wipro.fooddeliveryapp.menu.repositorys.MenuRepository;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class MenuServiceImpl implements MenuService {
	private final MenuRepository menuRepository;
	private final RestaurantClient restaurantClient;

	public Menu saveMenu(Menu menu) {
		 RestaurantDTO restaurant = restaurantClient.getRestaurantById(menu.getRestaurantId());
	        if (restaurant == null) {
	            throw new RuntimeException("Restaurant not found with ID: " + menu.getRestaurantId());
	        }
	        return menuRepository.save(menu);
	    }
	

	public List<Menu> getAllMenus() {
		return menuRepository.findAll();
	}

	public Menu getMenuById(Long id) {
		return menuRepository.findById(id).orElseThrow(() -> new RuntimeException("Menu not found with ID: " + id));
	}

	public List<Menu> getMenusByRestaurantId(Long restaurantId) {
		return menuRepository.findByRestaurantId(restaurantId);
	}

	public List<Menu> getSelectedMenus(Long restaurantId, List<String> itemNames) {
		return menuRepository.findByRestaurantIdAndItemNameIn(restaurantId, itemNames);
	}

	public Menu updateMenu(Long id, Menu updatedMenu) {
		Menu existing = getMenuById(id);

		existing.setItemName(updatedMenu.getItemName());
		existing.setPrice(updatedMenu.getPrice());
		existing.setRestaurantId(updatedMenu.getRestaurantId());

		return menuRepository.save(existing);
	}

	public void deleteMenu(Long id) {
		Menu existing = getMenuById(id);
		menuRepository.delete(existing);
	}

}
